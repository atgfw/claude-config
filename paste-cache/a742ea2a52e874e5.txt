{%- set ct_raw = CTX.call_transcript -%}{%- set ct = ct_raw|from_yaml_string if ct_raw is string else ct_raw|d({}) -%}{%- set transcript_entries = ct.transcript|d([]) -%}{%- set transcript_lines = [] -%}{%- for turn in transcript_entries -%}  {%- set turn_text = turn.text|d('')|string -%}  {%- if turn_text and turn_text|lower not in ['','none','null'] -%}    {%- set role_label = 'Agent' if turn.role == 'agent' else 'Caller' -%}    {%- set _ = transcript_lines.append(role_label ~ ': ' ~ turn_text) -%}  {%- endif -%}{%- endfor -%}{%- set transcript_text = transcript_lines|join('\n') -%}{%- set occ_vars = CTX.occ_settings.vars|d({}) -%}{%- set prefs_slim = {  'company_name': occ_vars.occ_notification_routing_preferences.company.company_name|d(''),  'locations': occ_vars.occ_notification_routing_preferences.locations|d([])|map(attribute='location_name')|list,  'departments': []} -%}{%- for loc in occ_vars.occ_notification_routing_preferences.locations|d([]) -%}  {%- for dept in loc.departments|d([]) -%}    {%- if dept.department_name|d('') not in prefs_slim.departments -%}      {%- set _ = prefs_slim.departments.append(dept.department_name) -%}    {%- endif -%}  {%- endfor -%}{%- endfor -%}{{ {  'input_data': transcript_text,  'categories': ['caller', 'contact', 'routing', 'request'],  'source_metadata': {    'conversation_id': ct.conversation_id|d(CTX.conversation_id)|d(''),    'agent_id': ct.agent_id|d(CTX.agent_id)|d(''),    'session_id': CTX.session_id|d(''),    'duration_secs': ct.call.duration_secs|d(CTX.call_duration_secs)|d(0),    'channel': 'voice',    'company_config': prefs_slim  },  'llm_config': {    'model': 'gpt-5.2',    'temperature': 0.1  }}|tojson }}